<!DOCTYPE html>
<html lang="en-US" class="scheme_original">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="https://gmpg.org/xfn/11">
	<title>Reservation - Terrascon Restaurant</title>

	<!-- Fonts -->
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Josefin+Sans:wght@300;400;700&display=swap" rel="stylesheet">

	<!-- Stylesheets -->
	<link rel="stylesheet" id="laurent-elated-font_elegant-css" href="css/elegant-icons-style.min.css" type="text/css" media="all">
	<link rel="stylesheet" id="laurent-elated-font_awesome-css" href="css/css-fontawesome-all.min.css" type="text/css" media="all">
	<link rel="stylesheet" id="laurent-style-css" href="css/laurent-style.css" type="text/css" media="all">
	<link rel="stylesheet" id="laurent-modules-css" href="css/css-modules.min.css" type="text/css" media="all">

	<style>
		/* Reset and base styles */
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Josefin Sans', sans-serif;
			background-color: #0f1d22;
			color: #C9AB81;
			line-height: 1.6;
		}

		/* Navbar wrapper styling */
		.eltdf-wrapper {
			background-color: #0f1d22;
		}

		.eltdf-page-header {
			position: relative;
			z-index: 100;
			background-color: #0f1d22;
		}

		.eltdf-menu-area {
			padding: 20px 0;
			background-color: transparent;
		}

		.eltdf-main-menu ul li a {
			color: #C9AB81 !important;
			font-family: 'Josefin Sans', sans-serif;
			text-transform: uppercase;
			letter-spacing: 2px;
			transition: all 0.3s ease;
		}

		.eltdf-main-menu ul li a:hover,
		.eltdf-main-menu ul li.eltdf-active-item a {
			color: #ffffff !important;
		}

		.eltdf-vertical-align-containers {
			display: flex;
			justify-content: space-between;
			align-items: center;
			max-width: 1300px;
			margin: 0 auto;
			padding: 0 40px;
		}

		.eltdf-position-left,
		.eltdf-position-center,
		.eltdf-position-right {
			display: flex;
			align-items: center;
		}

		.eltdf-position-center {
			flex: 1;
			justify-content: center;
		}

		.eltdf-main-menu ul {
			list-style: none;
			display: flex;
			gap: 35px;
			margin: 0;
			padding: 0;
		}

		.eltdf-main-menu ul li {
			position: relative;
		}

		.eltdf-side-menu-icon svg {
			width: 30px;
			height: 20px;
			stroke: #C9AB81;
			stroke-width: 2px;
			transition: stroke 0.3s ease;
		}

		.eltdf-side-menu-button-opener:hover .eltdf-side-menu-icon svg {
			stroke: #ffffff;
		}

		/* Header Section */
		.reservation-header {
			background-color: #0f1d22;
			padding: 60px 20px;
			text-align: center;
			margin-top: 0;
		}

		.header-content {
			max-width: 800px;
			margin: 0 auto;
		}

		.header-title {
			font-family: 'Playfair Display', serif;
			font-size: 48px;
			font-weight: 400;
			color: #C9AB81;
			margin-bottom: 20px;
			animation: fadeInDown 1s ease-out;
		}

		.header-subtitle {
			font-family: 'Josefin Sans', sans-serif;
			font-size: 18px;
			color: rgba(201, 171, 129, 0.8);
			line-height: 1.6;
			animation: fadeInUp 1s ease-out 0.3s both;
		}

		/* Two equal boxes layout */
		.reservation-wrapper {
			display: flex;
			min-height: 70vh;
			max-width: 1200px;
			margin: 40px auto;
			padding: 0 20px;
			gap: 80px;
		}

		/* Left Box - Image */
		.image-box {
			flex: 1;
			background: linear-gradient(rgba(15, 29, 34, 0.6), rgba(15, 29, 34, 0.6)), url('images/image1.jpeg');
			background-size: cover;
			background-position: center;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			animation: fadeInLeft 1.2s ease-out 0.5s both;
		}

		.image-overlay {
			text-align: center;
			padding: 40px;
		}

		.image-title {
			font-family: 'Playfair Display', serif;
			font-size: 48px;
			font-weight: 400;
			color: #C9AB81;
			margin-bottom: 20px;
			text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
		}

		.image-subtitle {
			font-family: 'Josefin Sans', sans-serif;
			font-size: 18px;
			color: rgba(201, 171, 129, 0.9);
			line-height: 1.6;
		}

		/* Right Box - Reservation Form */
		.form-box {
			flex: 1;
			background-color: rgba(255, 255, 255, 0.02);
			padding: 40px 30px;
			overflow-y: auto;
			animation: fadeInRight 1.2s ease-out 0.7s both;
		}

		/* Form styling */
		.reservation-form {
			max-width: 500px;
			margin: 0 auto;
		}

		.form-title {
			font-family: 'Playfair Display', serif;
			font-size: 36px;
			font-weight: 400;
			color: #C9AB81;
			text-align: center;
			margin-bottom: 40px;
			animation: fadeIn 1s ease-out 1s both;
		}

		.form-row {
			display: flex;
			gap: 20px;
			margin-bottom: 25px;
		}

		.form-group {
			flex: 1;
		}

		.form-group.full-width {
			flex: none;
			width: 100%;
		}

		.form-label {
			display: block;
			font-family: 'Josefin Sans', sans-serif;
			font-size: 14px;
			font-weight: 400;
			color: #C9AB81;
			margin-bottom: 8px;
			text-transform: uppercase;
			letter-spacing: 1px;
		}

		.form-input {
			width: 100%;
			padding: 15px;
			border: 1px solid rgba(201, 171, 129, 0.3);
			border-radius: 6px;
			background: rgba(255, 255, 255, 0.02);
			color: #C9AB81;
			font-family: 'Josefin Sans', sans-serif;
			font-size: 14px;
			font-weight: 300;
			transition: all 0.3s ease;
		}

		/* Calendar input specific styling */
		.form-input[type="date"] {
			color: #C9AB81;
			background: rgba(255, 255, 255, 0.02);
			border: 1px solid rgba(201, 171, 129, 0.3);
		}

		/* Webkit calendar styling */
		.form-input[type="date"]::-webkit-calendar-picker-indicator {
			filter: invert(1) brightness(0.8);
			cursor: pointer;
		}

		.form-input:focus {
			outline: none;
			border-color: #C9AB81;
			box-shadow: 0 0 0 2px rgba(201, 171, 129, 0.2);
		}

		.form-select {
			width: 100%;
			padding: 15px;
			border: 1px solid rgba(201, 171, 129, 0.3);
			border-radius: 6px;
			background: rgba(255, 255, 255, 0.02);
			color: #C9AB81;
			font-family: 'Josefin Sans', sans-serif;
			font-size: 14px;
			font-weight: 300;
			appearance: none;
			cursor: pointer;
		}

		.form-select:focus {
			outline: none;
			border-color: #C9AB81;
			box-shadow: 0 0 0 2px rgba(201, 171, 129, 0.2);
		}

		/* Custom dropdown styling */
		.custom-dropdown {
			position: relative;
		}

		.custom-dropdown::after {
			content: '\f107';
			font-family: 'Font Awesome 5 Free';
			font-weight: 900;
			position: absolute;
			right: 15px;
			top: 50%;
			transform: translateY(-50%);
			color: #C9AB81;
			pointer-events: none;
		}

		.submit-btn {
			width: 100%;
			padding: 18px;
			background: #C9AB81;
			border: none;
			border-radius: 6px;
			color: #0f1d22;
			font-family: 'Josefin Sans', sans-serif;
			font-size: 16px;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 1px;
			cursor: pointer;
			transition: all 0.3s ease;
			margin-top: 10px;
			animation: bounceIn 1s ease-out 1.5s both;
		}

		.submit-btn:hover {
			background: rgba(201, 171, 129, 0.9);
			transform: translateY(-2px);
		}

		/* Responsive design */
		@media (max-width: 1024px) {
			.eltdf-main-menu ul {
				gap: 20px;
			}

			.eltdf-main-menu ul li a {
				font-size: 13px;
			}

			.eltdf-vertical-align-containers {
				padding: 0 20px;
			}
		}

		@media (max-width: 768px) {
			.eltdf-main-menu {
				display: none;
			}

			.eltdf-vertical-align-containers {
				justify-content: space-between;
			}

			.eltdf-logo-text {
				font-size: 24px !important;
				margin-left: -150px ;
			}

			.reservation-wrapper {
				flex-direction: column;
				min-height: auto;
			}

			.image-box {
				min-height: 300px;
			}

			.form-box {
				padding: 40px 20px;
			}

			.form-row {
				flex-direction: column;
				gap: 15px;
			}

			.image-title {
				font-size: 32px;
			}

			.form-title {
				font-size: 28px;
			}
		}

        /* Message Styles */
        .reservation-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(42, 42, 42, 0.95);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideInDown 0.3s ease-out;
            max-width: 90%;
            width: auto;
        }

        .success-message {
            border-left: 4px solid #059669;
        }

        .error-message {
            border-left: 4px solid #dc2626;
        }

        .message-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .success-message .message-icon {
            background: rgba(5, 150, 105, 0.2);
            color: #10b981;
        }

        .error-message .message-icon {
            background: rgba(220, 38, 38, 0.2);
            color: #ef4444;
        }

        .message-text {
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            line-height: 1.4;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Animation Keyframes */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

		@keyframes fadeInUp {
			from {
				opacity: 0;
				transform: translateY(30px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@keyframes fadeInLeft {
			from {
				opacity: 0;
				transform: translateX(-50px);
			}
			to {
				opacity: 1;
				transform: translateX(0);
			}
		}

		@keyframes fadeInRight {
			from {
				opacity: 0;
				transform: translateX(50px);
			}
			to {
				opacity: 1;
				transform: translateX(0);
			}
		}

		@keyframes bounceIn {
			0% {
				opacity: 0;
				transform: scale(0.3);
			}
			50% {
				opacity: 1;
				transform: scale(1.05);
			}
			70% {
				transform: scale(0.9);
			}
			100% {
				opacity: 1;
				transform: scale(1);
			}
		}
	</style>
</head>
<body>
	<style>
		/* Disable all navbar dropdowns on hover */
		.eltdf-main-menu.eltdf-drop-down .second {
			display: none !important;
			opacity: 0 !important;
			visibility: hidden !important;
			height: 0 !important;
			pointer-events: none !important;
		}

		.eltdf-main-menu.eltdf-drop-down li:hover>.second {
			display: none !important;
			opacity: 0 !important;
			visibility: hidden !important;
			height: 0 !important;
			pointer-events: none !important;
		}
	</style>
	<div class="eltdf-wrapper">
		<div class="eltdf-wrapper-inner">
			<div class="eltdf-double-grid-line-one"></div>
			<div class="eltdf-double-grid-line-two"></div>
			<header class="eltdf-page-header">
				<div class="eltdf-header-double-grid-line-one"></div>
				<div class="eltdf-header-double-grid-line-two"></div>

				<div class="eltdf-menu-area eltdf-menu-center">


					<div class="eltdf-vertical-align-containers">
						<div class="eltdf-position-left"><!--
				 -->
							<div class="eltdf-position-left-inner">


								<div class="eltdf-logo-wrapper">
									<a itemprop="url" href="index.html">
										<span class="eltdf-logo-text"
											style="color: #C9AB81; font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 400; letter-spacing: 1px; margin-left: -20px;">Terrascon</span>
									</a>
								</div>

							</div>
						</div>
						<div class="eltdf-position-center"><!--
					 -->
							<div class="eltdf-position-center-inner">

								<nav class="eltdf-main-menu eltdf-drop-down eltdf-default-nav">
									<ul id="menu-main-menu" class="clearfix">
										<li id="nav-menu-item-13"
											class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor current-menu-parent menu-item-has-children has_sub narrow">
											<a href="index.html" class=""><span class="item_outer"><span
														class="item_text">Home</span></span></a>
											<div class="second">
												<div class="inner">
													<ul>
														<li id="nav-menu-item-14"
															class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home current-menu-item page_item page-item-7 current_page_item ">
															<a href="index.html" class=""><span
																	class="item_outer"><span class="item_text">Main
																		Home</span></span></a></li>
														<li id="nav-menu-item-389"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="bar-home.html" class=""><span
																	class="item_outer"><span class="item_text">Bar
																		Home</span></span></a></li>
														<li id="nav-menu-item-319"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="restaurant-home.html" class=""><span
																	class="item_outer"><span
																		class="item_text">Restaurant
																		Home</span></span></a></li>
														<li id="nav-menu-item-218"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="fine-dining.html" class=""><span
																	class="item_outer"><span class="item_text">Fine
																		Dining</span></span></a></li>
														<li id="nav-menu-item-893"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="split-screen-showcase.html" class=""><span
																	class="item_outer"><span class="item_text">Split
																		Screen Showcase</span></span></a></li>
														<li id="nav-menu-item-food-menu"
															class="menu-item menu-item-type-custom menu-item-object-custom ">
															<a href="javascript:void(0)" onclick="downloadFoodMenu()" class=""><span
																	class="item_outer"><span class="item_text">Food
																		Menu</span></span></a></li>
														<li id="nav-menu-item-wine-menu"
															class="menu-item menu-item-type-custom menu-item-object-custom ">
															<a href="javascript:void(0)" onclick="downloadWineMenu()" class=""><span
																	class="item_outer"><span class="item_text">Wine
																		Menu</span></span></a></li>
														<li id="nav-menu-item-231"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="haute-cuisine.html" class=""><span
																	class="item_outer"><span class="item_text">Haute
																		Cuisine</span></span></a></li>
														<li id="nav-menu-item-503"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="restaurant-menu.html" class=""><span
																	class="item_outer"><span
																		class="item_text">Restaurant
																		Menu</span></span></a></li>
														<li id="nav-menu-item-381"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="fullscreen-showcase.html" class=""><span
																	class="item_outer"><span
																		class="item_text">Fullscreen
																		Showcase</span></span></a></li>
														<li id="nav-menu-item-822"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="carousel-showcase.html" class=""><span
																	class="item_outer"><span class="item_text">Carousel
																		Showcase</span></span></a></li>
														<li id="nav-menu-item-1359"
															class="menu-item menu-item-type-post_type menu-item-object-page ">
															<a href="landing.html" class=""><span
																	class="item_outer"><span
																		class="item_text">Landing</span></span></a></li>
													</ul>
												</div>
											</div>
										</li>
										<li id="nav-menu-item-15"
											class="menu-item menu-item-type-custom menu-item-object-custom"><a
												href="index.html#food-menu" class=""><span class="item_outer"><span
														class="item_text">Food Menu</span></span></a></li>
										<li id="nav-menu-item-16"
											class="menu-item menu-item-type-custom menu-item-object-custom"><a
												href="index.html#wine-menu" class=""><span class="item_outer"><span
														class="item_text">Wine Menu</span></span></a></li>
										<li id="nav-menu-item-17"
											class="menu-item menu-item-type-custom menu-item-object-custom eltdf-active-item"><a
												href="booking-confirmation.html" class="current"><span class="item_outer"><span
														class="item_text">Reservation</span></span></a></li>
										<li id="nav-menu-item-18"
											class="menu-item menu-item-type-custom menu-item-object-custom"><a
												href="index.html#contact" class=""><span class="item_outer"><span
														class="item_text">Contact</span></span></a></li>
									</ul>
								</nav>

							</div>
						</div>
						<div class="eltdf-position-right"><!--
				 -->
							<div class="eltdf-position-right-inner">
							</div>
						</div>
					</div>

				</div>



			</header>

	<!-- Header Section -->
	<header class="reservation-header">
		<div class="header-content">
			<h1 class="header-title">Make a Reservation</h1>
			<p class="header-subtitle">Reserve your table for an unforgettable dining experience</p>
		</div>
	</header>

	<div class="reservation-wrapper">
		<!-- Left Box - Image Section -->
		<div class="image-box">
		</div>

		<!-- Right Box - Reservation Form -->
		<div class="form-box">
			<div class="reservation-form">
				<h2 class="form-title">Make a Reservation</h2>

				<form action="booking-confirmation.html" method="get">
					<div class="form-row">
						<div class="form-group">
							<label class="form-label" for="firstName">First Name</label>
							<input type="text" id="firstName" name="firstName" class="form-input" required>
						</div>
						<div class="form-group">
							<label class="form-label" for="lastName">Last Name</label>
							<input type="text" id="lastName" name="lastName" class="form-input" required>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group">
							<label class="form-label" for="email">Email</label>
							<input type="email" id="email" name="email" class="form-input" required>
						</div>
						<div class="form-group">
							<label class="form-label" for="phone">Phone</label>
							<input type="tel" id="phone" name="phone" class="form-input" required>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group">
							<label class="form-label" for="partySize">Party Size</label>
							<select id="partySize" name="partysize" class="form-select custom-dropdown" required>
								<option value="">Select party size</option>
								<option value="1">1 Person</option>
								<option value="2">2 People</option>
								<option value="3">3 People</option>
								<option value="4">4 People</option>
								<option value="5">5 People</option>
								<option value="6">6 People</option>
								<option value="7">7 People</option>
								<option value="8">8 People</option>
							</select>
						</div>
						<div class="form-group">
							<label class="form-label" for="reservationDate">Date</label>
							<input type="date" id="reservationDate" name="date" class="form-input" required>
						</div>
					</div>

					<div class="form-row" id="timeSlotContainer" style="display: none;">
						<div class="form-group full-width">
							<label class="form-label" for="reservationTime">Time</label>
							<select id="reservationTime" name="time" class="form-select custom-dropdown" required>
								<option value="">Select time</option>
								<!-- Time slots will be generated by JavaScript -->
							</select>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group full-width">
							<label class="form-label" for="specialRequests">Special Requests (Optional)</label>
							<textarea id="specialRequests" name="specialRequests" class="form-input" rows="4" placeholder="Any special dietary requirements or celebration notes..."></textarea>
						</div>
					</div>

					<button type="submit" class="submit-btn">Reserve Your Table</button>
				</form>
			</div>
		</div>
	</div>

    <script>
        // Connect booking form to Admin API so submissions appear in Admin Panel
        const API_BASE_URL = '/api';

        // Available time slots
        const timeSlots = [
            { value: '07:30-08:30', label: '07:30-08:30', category: 'Petit-d√©jeuner (07:30 - 10:30)' },
            { value: '08:30-09:30', label: '08:30-09:30', category: 'Petit-d√©jeuner (07:30 - 10:30)' },
            { value: '09:30-10:30', label: '09:30-10:30', category: 'Petit-d√©jeuner (07:30 - 10:30)' },
            { value: '12:00-13:00', label: '12:00-13:00', category: 'D√©jeuner (12:00 - 14:30)' },
            { value: '13:00-14:00', label: '13:00-14:00', category: 'D√©jeuner (12:00 - 14:30)' },
            { value: '13:30-14:30', label: '13:30-14:30', category: 'D√©jeuner (12:00 - 14:30)' },
            { value: '15:30-16:30', label: '15:30-16:30', category: 'Pause gourmande pour le th√© (15:30 - 17:30)' },
            { value: '16:30-17:30', label: '16:30-17:30', category: 'Pause gourmande pour le th√© (15:30 - 17:30)' },
            { value: '17:30-18:30', label: '17:30-18:30', category: 'After work convivial (17:30 - 19:30)' },
            { value: '18:30-19:30', label: '18:30-19:30', category: 'After work convivial (17:30 - 19:30)' },
            { value: '19:30-20:30', label: '19:30-20:30', category: 'D√Æner raffin√© (19:30 - 22:30)' },
            { value: '20:30-21:30', label: '20:30-21:30', category: 'D√Æner raffin√© (19:30 - 22:30)' },
            { value: '21:30-22:30', label: '21:30-22:30', category: 'D√Æner raffin√© (19:30 - 22:30)' }
        ];

        // Generate time slots based on confirmed bookings and admin availability settings
        async function generateTimeSlots() {
            const timeSelect = document.getElementById('reservationTime');
            const timeSlotContainer = document.getElementById('timeSlotContainer');
            const selectedDate = document.getElementById('reservationDate').value;

            if (!selectedDate) {
                timeSelect.innerHTML = '<option value="">Select date first</option>';
                timeSlotContainer.style.display = 'none';
                return;
            }
            
            // Show time slot container when date is selected
            timeSlotContainer.style.display = 'flex';

            try {
                // Fetch confirmed bookings for the selected date
                const response = await fetch(`${API_BASE_URL}/bookings`);
                const bookings = await response.json();

                // Filter confirmed bookings for the selected date
                const confirmedBookings = bookings.filter(booking =>
                    booking.date === selectedDate && booking.status === 'confirmed'
                );

                // Create a set of unavailable time slots (booked slots)
                const bookedUnavailableSlots = new Set();
                confirmedBookings.forEach(booking => {
                    if (booking.time) {
                        // Convert database time format (HH:MM:SS) to booking time (HH:MM)
                        const [hours, minutes] = booking.time.split(':');
                        const bookingTime = `${hours}:${minutes}`;

                        // Find time slot that contains this booking time
                        const matchingSlot = timeSlots.find(slot => {
                            const [slotStart, slotEnd] = slot.value.split('-');
                            const slotStartTime = slotStart;
                            const slotEndTime = slotEnd;
                            return bookingTime >= slotStartTime && bookingTime < slotEndTime;
                        });

                        if (matchingSlot) {
                            bookedUnavailableSlots.add(matchingSlot.value);
                        }
                    }
                });

                // Fetch admin-set time slot availability for the specific date only
                let adminAvailability = {};
                try {
                    const dateSpecificResponse = await fetch(`${API_BASE_URL}/time-slots/availability?date=${selectedDate}`);
                    if (dateSpecificResponse.ok) {
                        adminAvailability = await dateSpecificResponse.json();
                        console.log('Date-specific admin availability settings:', adminAvailability);
                    } else {
                        console.error('Failed to fetch admin availability:', dateSpecificResponse.status, dateSpecificResponse.statusText);
                    }
                } catch (availabilityError) {
                    console.error('Error fetching admin time slot availability:', availabilityError);
                    // Continue with default behavior if API fails
                }

                // Create a set of unavailable time slots (booked OR admin-disabled)
                const unavailableSlots = new Set();
                console.log('Processing time slots for availability...');
                console.log('Admin availability:', adminAvailability);
                console.log('Booked unavailable slots:', Array.from(bookedUnavailableSlots));

                timeSlots.forEach(slot => {
                    const isBookedUnavailable = bookedUnavailableSlots.has(slot.value);
                    const isAdminUnavailable = adminAvailability[slot.value] === false;
                    console.log(`Slot ${slot.value}: booked=${isBookedUnavailable}, admin=${isAdminUnavailable}`);

                    // Slot is unavailable if it's booked OR admin-set as unavailable
                    if (isBookedUnavailable || isAdminUnavailable) {
                        unavailableSlots.add(slot.value);
                        console.log(`Marking ${slot.value} as unavailable`);
                    }
                });

                console.log('Final unavailable slots:', Array.from(unavailableSlots));

                // Group time slots by category
                const categories = {};
                timeSlots.forEach(slot => {
                    if (!categories[slot.category]) {
                        categories[slot.category] = [];
                    }
                    categories[slot.category].push(slot);
                });

                // Generate HTML for time slots
                let html = '<option value="">Select time</option>';
                Object.entries(categories).forEach(([category, slots]) => {
                    html += `<optgroup label="${category}">`;
                    slots.forEach(slot => {
                        const isDisabled = unavailableSlots.has(slot.value);
                        const disabledAttr = isDisabled ? 'disabled style="color: #666;"' : '';
                        const text = isDisabled ? `${slot.label} (Unavailable)` : slot.label;
                        html += `<option value="${slot.value}" ${disabledAttr}>${text}</option>`;
                    });
                    html += '</optgroup>';
                });

                timeSelect.innerHTML = html;

                // Ensure dropdown is enabled after successful API call
                timeSelect.disabled = false;

                // Clear any existing error messages
                hideMessages();

                // If all slots are disabled, show a message
                const availableOptions = timeSelect.querySelectorAll('option:not([disabled]):not([value=""])');
                if (availableOptions.length === 0) {
                    timeSelect.innerHTML = '<option value="">No time slots available for this date</option>';
                }

            } catch (error) {
                console.error('Error fetching bookings:', error);
                // Show error message and disable time selection if API fails
                showErrorMessage('Unable to check availability. Please try refreshing or contact the restaurant directly.');
                const timeSelect = document.getElementById('reservationTime');
                timeSelect.innerHTML = '<option value="">Unable to check availability - try refreshing</option>';
                timeSelect.disabled = true;

                // Add refresh button functionality
                const refreshBtn = document.createElement('button');
                refreshBtn.type = 'button';
                refreshBtn.innerHTML = 'üîÑ Refresh Availability';
                refreshBtn.className = 'submit-btn';
                refreshBtn.style.marginTop = '10px';
                refreshBtn.style.fontSize = '14px';
                refreshBtn.onclick = function() {
                    timeSelect.disabled = false;
                    timeSelect.innerHTML = '<option value="">Loading...</option>';
                    generateTimeSlots();
                    // Remove the refresh button after successful refresh
                    refreshBtn.remove();
                };

                // Insert refresh button after time select
                timeSelect.parentNode.insertBefore(refreshBtn, timeSelect.nextSibling);
            }
        }

        function generateFallbackTimeSlots() {
            const timeSelect = document.getElementById('reservationTime');

            const categories = {};
            timeSlots.forEach(slot => {
                if (!categories[slot.category]) {
                    categories[slot.category] = [];
                }
                categories[slot.category].push(slot);
            });

            let html = '<option value="">Select time</option>';
            Object.entries(categories).forEach(([category, slots]) => {
                html += `<optgroup label="${category}">`;
                slots.forEach(slot => {
                    html += `<option value="${slot.value}">${slot.label}</option>`;
                });
                html += '</optgroup>';
            });

            timeSelect.innerHTML = html;
        }

        // Success and error message functions
        function showSuccessMessage(message) {
            // Remove any existing messages
            hideMessages();

            // Create success message element
            const successDiv = document.createElement('div');
            successDiv.className = 'reservation-message success-message';
            successDiv.innerHTML = `
                <div class="message-icon">‚úì</div>
                <div class="message-text">${message}</div>
            `;

            // Insert after the header
            const header = document.querySelector('.reservation-header');
            if (header) {
                header.appendChild(successDiv);
            }

            // Auto-hide after 3 seconds
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }

        function showErrorMessage(message) {
            // Remove any existing messages
            hideMessages();

            // Create error message element
            const errorDiv = document.createElement('div');
            errorDiv.className = 'reservation-message error-message';
            errorDiv.innerHTML = `
                <div class="message-icon">‚ö†</div>
                <div class="message-text">${message}</div>
            `;

            // Insert after the header
            const header = document.querySelector('.reservation-header');
            if (header) {
                header.appendChild(errorDiv);
            }

            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        function hideMessages() {
            const existingMessages = document.querySelectorAll('.reservation-message');
            existingMessages.forEach(msg => msg.remove());
        }

        // Set minimum date to today
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('reservationDate');
            const timeSelect = document.getElementById('reservationTime');
            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);

            // Keep time slot hidden/disabled until the user selects a date
            const timeSlotContainer = document.getElementById('timeSlotContainer');
            if (timeSlotContainer) timeSlotContainer.style.display = 'none';
            if (timeSelect) {
                timeSelect.innerHTML = '<option value="">Select date first</option>';
                timeSelect.disabled = true;
            }

            // Add event listener for date changes
            dateInput.addEventListener('change', function() {
                // Small delay to ensure smooth UX
                setTimeout(() => {
                    generateTimeSlots();
                }, 100);
            });

            // Lightweight live refresh: refresh slots when dropdown opens, but not during selection
            let refreshTimeout;
            const refreshSlots = () => {
                // If date is not selected (should be set above), skip
                if (!document.getElementById('reservationDate').value) return;
                generateTimeSlots();
            };

            if (timeSelect) {
                // Only refresh when dropdown opens, not during interaction
                timeSelect.addEventListener('focus', function() {
                    // Delay refresh to avoid interfering with dropdown opening
                    clearTimeout(refreshTimeout);
                    refreshTimeout = setTimeout(refreshSlots, 100);
                });

                // Don't interfere with click events during selection
                // timeSelect.addEventListener('click', refreshSlots);
                // timeSelect.addEventListener('mousedown', refreshSlots);
                // timeSelect.addEventListener('pointerdown', refreshSlots);
            }

            // Also refresh when tab becomes visible again
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    // Delay refresh to ensure page is fully loaded
                    setTimeout(() => {
                        refreshSlots();
                    }, 500);
                }
            });

            // Removed manual refresh button in top-right corner per requirement

            // Hijack form submit and send to API
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    // Check if time selection is disabled due to API failure
                    const timeSelect = document.getElementById('reservationTime');
                    if (timeSelect.disabled || !timeSelect.value) {
                        showErrorMessage('Please select a valid time slot or refresh the page to check availability.');
                        return;
                    }

                    const formData = new FormData(form);

                    // Normalize date to YYYY-MM-DD
                    const rawDate = formData.get('date');
                    let normalizedDate = rawDate;
                    try {
                        const d = new Date(rawDate);
                        if (!isNaN(d.getTime())) normalizedDate = d.toISOString().split('T')[0];
                    } catch (_) {}

                    // Normalize time; if empty or a range, take start; ensure HH:MM:SS
                    let rawTime = formData.get('time') || '';
                    if (rawTime.includes('-')) rawTime = rawTime.split('-')[0];
                    rawTime = rawTime.replace(/\s?(AM|PM)$/i, '');
                    if (/^\d{1,2}:\d{2}$/.test(rawTime)) rawTime = `${rawTime}:00`;
                    if (!/^\d{1,2}:\d{2}:\d{2}$/.test(rawTime)) rawTime = '19:30:00';

                    const guests = parseInt(formData.get('partysize') || '1', 10) || 1;

                    const first = (formData.get('firstName') || '').trim();
                    const last = (formData.get('lastName') || '').trim();
                    const customerName = `${first} ${last}`.trim() || 'Guest';

                    const bookingData = {
                        customerName,
                        customerEmail: (formData.get('email') || '').trim(),
                        customerPhone: (formData.get('phone') || '').trim(),
                        date: normalizedDate,
                        time: rawTime,
                        guests,
                        specialRequests: formData.get('specialRequests') || ''
                    };

                    try {
                        const response = await fetch(`${API_BASE_URL}/bookings`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(bookingData)
                        });
                        const text = await response.text();
                        let result;
                        try { result = JSON.parse(text); } catch (_) { result = { success: false, error: text || 'Unknown error' }; }

                        if (result && result.success) {
                            // Show success message on page instead of popup
                            showSuccessMessage('Reservation successful!');
                            // Redirect to confirmation page after a short delay
                            setTimeout(() => {
                                window.location.href = `booking-confirmation.html?bookingId=${result.booking.id}`;
                            }, 2000);
                        } else {
                            showErrorMessage(`Unable to complete reservation. ${result.error || ''}`.trim());
                        }
                    } catch (err) {
                        console.error('Reservation error:', err);
                        alert('An error occurred. Please try again.');
                    }
                });
            }
        });

        // PDF Download Functions
        async function downloadFoodMenu() {
            try {
                console.log('Attempting to download Food Menu PDF...');

                // Use window.open for more reliable download
                const popup = window.open(`${API_BASE_URL}/menu/food_menu/pdf`, '_blank');

                // Check if popup was blocked
                if (!popup) {
                    alert('Popup blocked! Please allow popups for this site or use the direct link.');
                    // Fallback to direct navigation
                    window.location.href = `${API_BASE_URL}/menu/food_menu/pdf`;
                } else {
                    // Popup opened successfully
                    setTimeout(() => {
                        popup.close();
                    }, 1000);
                }

                console.log('Food Menu PDF download initiated');
            } catch (error) {
                console.error('Error downloading Food Menu PDF:', error);
                alert('Unable to download Food Menu PDF. Please try again later.');
            }
        }

        async function downloadWineMenu() {
            try {
                console.log('Attempting to download Wine Menu PDF...');

                // Use window.open for more reliable download
                const popup = window.open(`${API_BASE_URL}/menu/wine_menu/pdf`, '_blank');

                // Check if popup was blocked
                if (!popup) {
                    alert('Popup blocked! Please allow popups for this site or use the direct link.');
                    // Fallback to direct navigation
                    window.location.href = `${API_BASE_URL}/menu/wine_menu/pdf`;
                } else {
                    // Popup opened successfully
                    setTimeout(() => {
                        popup.close();
                    }, 1000);
                }

                console.log('Wine Menu PDF download initiated');
            } catch (error) {
                console.error('Error downloading Wine Menu PDF:', error);
                alert('Unable to download Wine Menu PDF. Please try again later.');
            }
        }
    </script>

		</div>
	</div>

</body>
</html>
